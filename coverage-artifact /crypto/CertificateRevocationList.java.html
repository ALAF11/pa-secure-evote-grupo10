<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CertificateRevocationList.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pa-secure-evote</a> &gt; <a href="index.source.html" class="el_package">crypto</a> &gt; <span class="el_source">CertificateRevocationList.java</span></div><h1>CertificateRevocationList.java</h1><pre class="source lang-java linenums">package crypto;

import org.slf4j.Logger;
import util.LoggingUtil;

import java.security.cert.X509Certificate;
import java.time.Instant;
import java.util.Collections;
import java.util.Map;
import java.util.Set;
import java.util.concurrent.ConcurrentHashMap;
import java.util.stream.Collectors;

/**
 * Manages certificate revocation for e-voting system.
 * &lt;p&gt;
 * This class is responsible for:
 * &lt;ul&gt;
 *     &lt;li&gt;Maintaining a list of revoked certificates and their
 *     revocation information&lt;/li&gt;
 *     &lt;li&gt;Checking whether certificates have been revoked&lt;/li&gt;
 *     &lt;li&gt;Providing revocation information for specific certificates&lt;/li&gt;
 *     &lt;li&gt;Generating Certificate Revocation Lists (CRLs) for export&lt;/li&gt;
 * &lt;/ul&gt;
 * &lt;p&gt;
 * Thread-safe implementation using ConcurrentHashMap for managing
 * concurrent access to the revocation list.
 */

<span class="fc" id="L30">public class CertificateRevocationList {</span>

<span class="fc" id="L32">    private static final Logger logger = LoggingUtil.getLogger(CertificateRevocationList.class);</span>
<span class="fc" id="L33">    private final Map&lt;String, RevocationInfo&gt; revokedCertificates = new ConcurrentHashMap&lt;&gt;();</span>

    /**
     * Revokes a certificate and adds it to the revocation list.
     *
     * @param serialNumber The serial number of the certificate to revoke
     * @param reason The reason for revocation
     * @return true if the certificate was successfully revoked, false if already revoked
     * @throws IllegalArgumentException If the serial number is null or empty
     */

    public boolean revokeCertificate(String serialNumber, String reason) {
<span class="fc bfc" id="L45" title="All 4 branches covered.">        if (serialNumber == null || serialNumber.isEmpty()) {</span>
<span class="fc" id="L46">            throw new IllegalArgumentException(&quot;Certificate serial number cannot be null or empty&quot;);</span>
        }

<span class="fc" id="L49">        RevocationInfo revocationInfo = new RevocationInfo(Instant.now(), reason);</span>
<span class="fc" id="L50">        RevocationInfo previous = revokedCertificates.put(serialNumber, revocationInfo);</span>

<span class="fc bfc" id="L52" title="All 2 branches covered.">        if (previous == null) {</span>
<span class="fc" id="L53">            logger.info(&quot;Certificate {} revoked: {}&quot;, serialNumber, reason);</span>
<span class="fc" id="L54">            return true;</span>
        } else {
<span class="fc" id="L56">            logger.info(&quot;Certificate {} already revoked on {}: {}&quot;,</span>
<span class="fc" id="L57">                    serialNumber, previous.getTimestamp(), previous.getReason());</span>
<span class="fc" id="L58">            return false;</span>
        }
    }

    /**
     * Checks if a certificate is revoked by its serial number.
     *
     * @param serialNumber The serial number of the certificate
     * @return true if the certificate is revoked, false otherwise
     */

    public boolean isRevoked(String serialNumber) {
<span class="fc" id="L70">        return revokedCertificates.containsKey(serialNumber);</span>
    }

    /**
     * Checks if an X.509 certificate is revoked.
     *
     * @param certificate The X.509 certificate to check
     * @return true if the certificate is revoked, false otherwise
     */

    public boolean isRevoked(X509Certificate certificate) {
<span class="fc" id="L81">        return isRevoked(certificate.getSerialNumber().toString());</span>
    }

    /**
     * Gets the revocation information for a specific certificate.
     *
     * @param serialNumber The serial number of the certificate
     * @return RevocationInfo object if the certificate is revoked,
     * null otherwise
     */

    public RevocationInfo getRevocationInfo(String serialNumber) {
<span class="fc" id="L93">        return revokedCertificates.get(serialNumber);</span>
    }


    /**
     * Gets all revoked certificates and their revocation information.
     *
     * @return An unmodifiable map of all revoked certificates
     */

    public Map&lt;String, RevocationInfo&gt; getAllRevokedCertificates() {
<span class="fc" id="L104">        return Collections.unmodifiableMap(revokedCertificates);</span>
    }

    /**
     * Exports the Certificate Revocation List in a formatted string.
     *
     * @return A formatted string containing the CRL information
     */

    public String exportCRL() {
<span class="fc" id="L114">        StringBuilder builder = new StringBuilder();</span>
<span class="fc" id="L115">        builder.append(&quot;Certificate Revocation List\n&quot;);</span>
<span class="fc" id="L116">        builder.append(&quot;Generated: &quot;).append(Instant.now()).append(&quot;\n&quot;);</span>
<span class="fc" id="L117">        builder.append(&quot;Revoked Certificates: &quot;).append(revokedCertificates.size()).append(&quot;\n&quot;);</span>

<span class="fc bfc" id="L119" title="All 2 branches covered.">        for (Map.Entry&lt;String, RevocationInfo&gt; entry : revokedCertificates.entrySet()) {</span>
<span class="fc" id="L120">            RevocationInfo info = entry.getValue();</span>
<span class="fc" id="L121">            builder.append(entry.getKey())</span>
<span class="fc" id="L122">                    .append(&quot; | Revoked at: &quot;).append(info.getTimestamp())</span>
<span class="fc" id="L123">                    .append(&quot; | Reason: &quot;).append(info.getReason())</span>
<span class="fc" id="L124">                    .append(&quot;\n&quot;);</span>
<span class="fc" id="L125">        }</span>

<span class="fc" id="L127">        return builder.toString();</span>
    }

    /**
     * Inner class representing certificate revocation information
     */

    public static class RevocationInfo {
        private final Instant timestamp;
        private final String reason;

        /**
         * Constructs a new RevocationInfo with the specified timestamp
         * and reason.
         *
         * @param timestamp The time of revocation
         * @param reason The reason for revocation
         */

<span class="fc" id="L146">        public RevocationInfo(Instant timestamp, String reason) {</span>
<span class="fc" id="L147">            this.timestamp = timestamp;</span>
<span class="fc" id="L148">            this.reason = reason;</span>
<span class="fc" id="L149">        }</span>

        /**
         * Gets the timestamp when the certificate was revoked.
         *
         * @return The revocation timestamp
         */

        public Instant getTimestamp() {
<span class="fc" id="L158">            return timestamp;</span>
        }

        /**
         * Gets the reason for certificate revocation.
         *
         * @return The revocation reason
         */

        public String getReason() {
<span class="fc" id="L168">            return reason;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>